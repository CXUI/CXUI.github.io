---
layout: post
title:  "Go 的包管理工具 dep"
date:   2019-03-20 13:00:00

categories: go
tags: tip
author: "Victor"
---

学 Go 的过程中总是在和 Ruby 不停的对比，今天就研究一波 package 依赖管理工具，类似 Ruby 世界的 bundle。

## 安装

```bash
brew install dep
dep version
```

## 创建新项目

首先创建一个新项目 `mkdir -p $GOPATH/src/github.com/me/example`

```bash
dep init
```

会新增 `Gopkg.toml, Gopkg.lock, vendor/`, 当然对于新项目来说这些文件和文件夹都是空的。这正是把 dep 加入 git 的好时机，可以让你回溯自己的更新历史。

* Gopkg.lock 是生成的文件，跟 Gemfile.lock 一样，别手动改
* Gopkg.toml 是依赖管理的核心文件，可以生成也可以手动修改
* vendor 目录里面的依赖代码是优先加载的，类似 node 的 node_module 目录

创建 main.go 之后，你可以先引入一些自己将要用到的 package

```bash
dep ensure -add github.com/foo/bar github.com/baz/quux
```

```bash
dep ensure -update -v // 更新
dep ensure // 工程中引入包、移除包、Gopkg.toml 规则修改等操作后，一定要执行
dep prune -v // 删除没有用到的包
```

参数 `-v` 是为了更好的查看执行过程，建议加上。

## 其它命令

```
dep help ensure
```

### 查看状态

```bash
dep status
```

* CONSTRAINT 为 Gopkg.toml 中限定的版本
* VERSION 为当前 vendor 中的版本
* REVISION 为当前 vendor 中的修订号
* LATEST 为 CONSTRAINT 限定下 github 中能满足要求的最新版本

### 修改限定版本并同步

修改 Gopkg.toml 中的 CONSTRAINT，若使得 LATEST 低于当前 vendor 中的版本，则运行 `dep ensure` 后，vendor 中的版本降低到能满足要求的最新版本。

若使得 LATEST 高于 vendor 中的版本，则运行 `dep ensure` 后，vendor 中的版本不变，可使用 `dep ensure -update` 更新 vendor 到 LATEST 版本。

### 限定版本含义

```
=: 等于
!=: 不等于
>: 大于
<: 小于
>=: 大于或等于
<=: 小于或等于
-: 文字范围。 如: 1.2 - 1.4.5相当于>= 1.2, <= 1.4.5
~: 次版本号范围。如: ~1.2.3相当于>= 1.2.3, < 1.3.0
^: 主版本号范围。特别说明：前面没有任何符号相当于^。如: ^1.2.3相当于>= 1.2.3, < 2.0.0，1.2.3相当于^1.2.3。
[xX*]: 通配符. 如: 1.2.x相当于>= 1.2.0, < 1.3.0
```

^从左边非零开始

```
^1.2.3 means 1.2.3 <= X < 2.0.0
^0.2.3 means 0.2.3 <= X < 0.3.0
^0.0.3 means 0.0.3 <= X < 0.1.0
```

## 相关文章

* [Windows下golang官方工具dep的使用](https://www.jianshu.com/p/e3c9f9039542)
* [dep初步使用](https://gocn.vip/article/631)
